<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 9</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
	<script type="text/javascript" src="js/Gamygdala.js"></script>
	<script type="text/javascript" src="js/GamygdalaPhaserPlugins.js"></script>
	<style type="text/css">
		body {
			margin: 0;
		}
	</style>
</head>
<body>

<script type="text/javascript">

var items = {
	"bank": 	{"name": "bank", 		"filename": "assets/objects/bank.png"},
	"boeken": 	{"name": "boeken", 		"filename": "assets/objects/boeken.gif"},
	"geld": 	{"name": "geld", 		"filename": "assets/objects/geld.png"},
	"gewichten":{"name": "gewichten", 	"filename": "assets/objects/gewichten.gif"},
	"gieter": 	{"name": "gieter", 		"filename": "assets/objects/gieter.png"},
	"gitaar": 	{"name": "gitaar", 		"filename": "assets/objects/gitaar.gif"},
	"groenten": {"name": "groenten", 	"filename": "assets/objects/groenten.gif"},
	"hamburger":{"name": "hamburger", 	"filename": "assets/objects/hamburger.png"},
	"koelkast": {"name": "koelkast", 	"filename": "assets/objects/koelkast.gif"},
	"koffie": 	{"name": "koffie", 		"filename": "assets/objects/koffie.gif"},
	"laptop": 	{"name": "laptop", 		"filename": "assets/objects/laptop.png"},
	"plant": 	{"name": "plant", 		"filename": "assets/objects/plant.png"},
	"ps4": 		{"name": "ps4", 		"filename": "assets/objects/ps4.png"},
	"radio": 	{"name": "radio", 		"filename": "assets/objects/radio.png"},
	"tv": 		{"name": "tv", 			"filename": "assets/objects/tv.png"},
	"zon": 		{"name": "zon", 		"filename": "assets/objects/zon.gif"}
};

var player;
var bad_guys=[];
var platforms;
var cursors;

var stars;
var lifes;
var score = 0;
var scoreText;

var hitTimer=0;
var NR_OF_STARS=10;
var NR_OF_BAD_GUYS=2;

var SCREEN_SIZE = {"WIDTH": 600, "HEIGHT": 600};

var emotionEngine;

var game = new Phaser.Game(SCREEN_SIZE.WIDTH, SCREEN_SIZE.HEIGHT, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

	game.load.image('sky', 'assets/sky.png');
	game.load.image('ground', 'assets/platform.png');
	game.load.image('star', 'assets/star.png');
	game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
	
	//The needed graphics for the bad guys and the lifebar
	game.load.spritesheet('badguy','assets/baddie.png', 32, 32);
	game.load.image('life', 'assets/life.png')

	//This line is needed for the Gamygdala.Expression plugin, if you make your own emotion expressions and effects, this is not needed.
	game.load.spritesheet('emotions', 'assets/emotions.png', 256, 256);

	// Preload all items
	for (item in items) {
		game.load.image(items[item].name, items[item].filename);
	}
}

function create() {
	game.add.sprite(0, 0, 'sky');

	items.gieter.sprite = game.add.sprite(100, 100, items.gieter.name);
	items.gieter.sprite.width = 64;
	items.gieter.sprite.height = 64;
	items.gieter.sprite.enableBody = true;
	game.physics.arcade.enable(items.gieter.sprite);
	items.gieter.sprite.body.gravity.y = 300;
	items.gieter.sprite.body.collideWorldBounds = true;
	items.gieter.sprite.body.bounce.x = 0.3;
	items.gieter.sprite.body.bounce.y = 0.3;
	items.gieter.sprite.body.drag.x = 100;

	items.plant.sprite = game.add.sprite(300, 100, items.plant.name);
	items.plant.sprite.width = 64;
	items.plant.sprite.height = 64;
	items.plant.sprite.enableBody = true;
	game.physics.arcade.enable(items.plant.sprite);
	items.plant.sprite.body.gravity.y = 300;
	items.plant.sprite.body.collideWorldBounds = true;

	// The player and its settings
	player = game.add.sprite(32, game.world.height - 150, 'dude');
	
	//  We need to enable physics on the player
	game.physics.arcade.enable(player);
	
	player.body.collideWorldBounds = true;

	//  Our two animations, walking left and right.
	player.animations.add('left', [0, 1, 2, 3], 10, true);
	player.animations.add('right', [5, 6, 7, 8], 10, true);
	player.animations.add('hit', [2, 4, 5], 20, true);

	// Now add the life bar
	lifes = game.add.group();
	for (var i=0;i<10;i++) {	
		lifes.create(16+i*32,50,'life');
	}
	
	scoreText = game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });

	cursors = game.input.keyboard.createCursorKeys();
	
	gamygdalaPlugin=new Phaser.Plugin.GamygdalaWrapper();//create the Phaser plugin.
	game.plugins.add(gamygdalaPlugin);//add the plugin to the game, as required by Phaser
	emotionEngine=gamygdalaPlugin.getGamygdala(); //this gives you a ref to the actual underlying emotion engine, so that you can do what you need to do.
	
	player.emotionAgent=emotionEngine.createAgent('player');
	
	emotionEngine.createGoalForAgent('player','survive', 0.7);
	emotionEngine.createGoalForAgent('player','win', 1);

	game.plugins.add(new Phaser.Plugin.GamygdalaExpression(game, player, player.emotionAgent));
	gamygdalaPlugin.phaserManagedDecay=true;
	emotionEngine.setGain(5);
}

function update() {

	game.physics.arcade.collide(player, platforms);
	game.physics.arcade.collide(player, items.gieter.sprite);

	game.physics.arcade.overlap(items.gieter.sprite, items.plant.sprite, callPlant, null, this);
	
	if (hitTimer<=0){
		// Reset the players velocity (movement)
		player.body.velocity.x = 0;
		player.body.velocity.y = 0;

		// Horizontal movement
		if (cursors.left.isDown) {
			player.body.velocity.x = -500;
		} else if (cursors.right.isDown) {
			player.body.velocity.x = 500;
		} else {
			player.body.velocity.x = 0;
		}
		
		// Vertical movement
		if (cursors.down.isDown) {
			player.body.velocity.y = 500;

		} else if (cursors.up.isDown) {
			player.body.velocity.y = -500;
		} else {
			player.body.velocity.y = 0;
		}
	} else {
		hitTimer--;
	}
}

function callPlant(player, plant) {
	emotionEngine.appraiseBelief(1,'player',['win'],[0.3], true);
	score += 1;
	scoreText.text = 'Score: ' + score; 

	plant.kill();
}

</script>
</body>
</html>